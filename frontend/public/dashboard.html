<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resenha Trader - Dashboard Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': '#0a0a0a',
                        'dark-light': '#141414',
                        'dark-lighter': '#1a1a1a',
                        'gold': '#FFD700',
                        'gold-dark': '#FFA500',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            color: #fafafa;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #141414;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: linear-gradient(180deg, #141414 0%, #0a0a0a 100%);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            margin: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #9ca3af;
            text-decoration: none;
        }
        
        .sidebar-item:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1));
            color: #FFD700;
            font-weight: 600;
        }
        
        .sidebar-item i {
            font-size: 20px;
            width: 24px;
            margin-right: 16px;
            transition: all 0.3s;
        }
        
        .sidebar.collapsed .sidebar-item span {
            display: none;
        }
        
        .sidebar.collapsed .sidebar-item {
            justify-content: center;
            padding: 14px;
        }
        
        .sidebar.collapsed .sidebar-item i {
            margin-right: 0;
        }
        
        /* Main content */
        .main-content {
            margin-left: 280px;
            padding: 24px;
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        
        .main-content.expanded {
            margin-left: 80px;
        }
        
        /* Cards */
        .card {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 215, 0, 0.2);
        }
        
        /* Stats card */
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        /* Signal card */
        .signal-card {
            background: #141414;
            border: 1px solid #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .signal-card:hover {
            border-color: #FFD700;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.1);
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-buy {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-sell {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .badge-premium {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            color: #FFD700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Page transitions */
        .page {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Pulse animation for critical badges */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        .badge-critica {
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-gold to-gold-dark flex items-center justify-center">
                    <i class="fas fa-chart-line text-dark text-lg"></i>
                </div>
                <div class="sidebar-text">
                    <h1 class="text-lg font-bold text-white">Resenha Trader</h1>
                    <p class="text-xs text-gray-400">Trading Intelligence</p>
                </div>
            </div>
        </div>
        
        <!-- Menu -->
        <nav class="py-6">
            <a href="#" class="sidebar-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Página Inicial</span>
            </a>
            <a href="#" class="sidebar-item" data-page="sinais">
                <i class="fas fa-signal"></i>
                <span>Sinais Trading</span>
            </a>
            <a href="#" class="sidebar-item" data-page="assimetria">
                <i class="fas fa-chart-area"></i>
                <span>Assimetria</span>
            </a>
            <a href="#" class="sidebar-item" data-page="ciclo">
                <i class="fas fa-sync-alt"></i>
                <span>Ciclo Fundamentalista</span>
            </a>
            <a href="#" class="sidebar-item" data-page="blog">
                <i class="fas fa-book"></i>
                <span>Manual</span>
            </a>
        </nav>
        
        <!-- Toggle button -->
        <div class="absolute bottom-6 left-0 right-0 px-4">
            <button onclick="toggleSidebar()" class="w-full py-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition flex items-center justify-center">
                <i class="fas fa-bars text-gray-400"></i>
            </button>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2" id="pageTitle">Página Inicial</h1>
                    <p class="text-gray-400" id="pageSubtitle">Visão geral do mercado</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="card py-2 px-4">
                        <span class="text-xs text-gray-400">Última atualização:</span>
                        <span class="text-xs text-white font-medium ml-2" id="lastUpdate">Carregando...</span>
                    </div>
                    <button onclick="recarregarDados()" class="card py-2 px-4 hover:bg-gray-800">
                        <i class="fas fa-sync-alt text-gray-400 hover:text-gold transition"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- HOME PAGE -->
        <div class="page active" id="page-home">
            <!-- Card de Assimetria -->
            <div class="card mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-chart-area text-blue-500 mr-3"></i>
                        Análise de Assimetria (Z-Score)
                    </h2>
                    <a href="#" onclick="navigateTo('assimetria'); return false;" 
                       class="px-4 py-2 bg-gold text-dark font-medium rounded-lg hover:bg-gold-dark transition">
                        Ver todos <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                
                <!-- Grid de cards de resumo -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Total -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center">
                                <i class="fas fa-chart-area text-blue-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-total">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Total de Sinais</h3>
                    </div>

                    <!-- Sobrecompra -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600/20 to-blue-600/10 flex items-center justify-center">
                                <i class="fas fa-arrow-down text-blue-600 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-sobrecomprados">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sobrecompra ↓</h3>
                        <div class="text-xs text-gray-500">Acima da média</div>
                    </div>

                    <!-- Sobrevenda -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500/20 to-red-500/10 flex items-center justify-center">
                                <i class="fas fa-arrow-up text-red-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-sobrevendidos">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sobrevenda ↑</h3>
                        <div class="text-xs text-gray-500">Abaixo da média</div>
                    </div>

                    <!-- Críticas -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-600/20 to-orange-600/10 flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-orange-600 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-criticas">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sinais Críticos (±3σ)</h3>
                        <div class="text-xs text-gray-500">Desvios extremos</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SINAIS PAGE -->
        <div class="page" id="page-sinais">
            <div class="card mb-6">
                <h2 class="text-lg font-bold mb-4">Filtros</h2>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <input type="text" id="searchTicker" placeholder="Buscar ticker..." 
                           class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                    
                    <select id="filterSignal" class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="all">Todos os sinais</option>
                        <option value="Compra">▲ Compra</option>
                        <option value="Venda">▼ Venda</option>
                    </select>
                    
                    <select id="filterQuality" class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="all">Todas qualidades</option>
                        <option value="PREMIUM">💎 Premium</option>
                        <option value="BOM">⭐ Bom</option>
                        <option value="REGULAR">⚡ Regular</option>
                        <option value="FRACO">⚠️ Fraco</option>
                    </select>
                    
                    <select id="filterSetup" class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="all">Todos os Setups</option>
                    </select>
                    
                    <button onclick="clearTradingFilters()" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-lg transition">
                        <i class="fas fa-times mr-2"></i>Limpar
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="allSignals">
                <div class="text-center py-8 text-gray-500">
                    <div class="loading mx-auto mb-4"></div>
                    <p>Carregando sinais...</p>
                </div>
            </div>
        </div>
        
        <!-- ASSIMETRIA PAGE -->
        <div class="page" id="page-assimetria">
            <!-- Header -->
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white mb-2">Assimetria (Z-Score)</h2>
                <p class="text-gray-400">Análise de distância da média móvel de 6 meses em desvios padrão</p>
            </div>

            <!-- Cards de Resumo -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center">
                            <i class="fas fa-chart-area text-blue-500 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-total">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Total de Sinais</h3>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600/20 to-blue-600/10 flex items-center justify-center">
                            <i class="fas fa-arrow-down text-blue-600 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-sobrecomprados">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sobrecompra ↓</h3>
                    <div class="text-xs text-gray-500">Acima da média</div>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500/20 to-red-500/10 flex items-center justify-center">
                            <i class="fas fa-arrow-up text-red-500 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-sobrevendidos">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sobrevenda ↑</h3>
                    <div class="text-xs text-gray-500">Abaixo da média</div>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-600/20 to-orange-600/10 flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-orange-600 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-criticas">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sinais Críticos (±3σ)</h3>
                    <div class="text-xs text-gray-500">Desvios extremos</div>
                </div>
            </div>

            <!-- Gráfico de Dispersão -->
            <div class="card mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gráfico de Dispersão</h3>
                    <div class="text-sm">
                        <span class="text-blue-500">● Sobrecompra</span>
                        <span class="text-red-500 ml-4">● Sobrevenda</span>
                    </div>
                </div>

                <div class="relative bg-gray-900 rounded-lg p-4" style="height: 400px;">
                    <canvas id="assimetriaChart"></canvas>
                </div>

                <!-- Controles do gráfico -->
                <div class="flex items-center gap-4 mt-4">
                    <input type="text" id="customTickersInput" placeholder="PETR4, VALE3..."
                           class="flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                    <button onclick="addCustomTickersToChart()"
                            class="px-4 py-2 bg-gold text-dark font-medium rounded-lg hover:bg-gold-dark transition">
                        Adicionar ao Gráfico
                    </button>
                    <button onclick="resetChart()"
                            class="px-4 py-2 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-600 transition">
                        Reset (Apenas ±2σ)
                    </button>
                </div>

                <div class="text-xs text-gray-500 mt-2">
                    💡 Adicione tickers customizados ao gráfico separados por vírgula
                </div>
            </div>

            <!-- Filtros -->
            <div class="card mb-6">
                <h3 class="text-lg font-bold mb-4">Filtros</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="filterTicker" placeholder="Buscar ticker..." oninput="applyAssimetriaFilters()"
                           class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">

                    <select id="filterStatus" onchange="applyAssimetriaFilters()"
                            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="">Todos os Status</option>
                        <option value="Sobrecomprado">Sobrecompra</option>
                        <option value="Sobrevendido">Sobrevenda</option>
                    </select>

                    <select id="filterNivel" onchange="applyAssimetriaFilters()"
                            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="">Todos os Níveis</option>
                        <option value="Crítica">🔴 Crítica</option>
                        <option value="Alta">🟨 Alta</option>
                        <option value="Moderada">🟦 Moderada</option>
                    </select>
                    
                    <button onclick="clearAssimetriaFilters()" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-lg transition">
                        <i class="fas fa-times mr-2"></i>Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Tabela de Assimetria -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">Tabela de Assimetria</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('ticker')">
                                    Ticker <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('valor_atual')">
                                    Valor Atual <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('media_6m')">
                                    Média 6M <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('z_score')">
                                    Z-Score <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('volatilidade_anualizada')">
                                    Volatilidade <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium">
                                    Status
                                </th>
                            </tr>
                        </thead>
                        <tbody id="assimetriaTableBody">
                            <tr>
                                <td colspan="6" class="text-center py-8">
                                    <div class="loading mx-auto mb-4"></div>
                                    <p class="text-gray-500">Carregando dados...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Loading State -->
            <div id="assimetriaLoading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="card p-8 text-center">
                    <div class="loading mx-auto mb-4"></div>
                    <p class="text-white">Carregando dados de assimetria...</p>
                </div>
            </div>

            <!-- Empty State -->
            <div id="assimetriaEmpty" class="hidden card text-center py-16">
                <i class="fas fa-chart-area text-6xl text-gray-600 mb-6"></i>
                <h3 class="text-xl font-bold mb-2">Nenhum sinal de assimetria disponível</h3>
                <p class="text-gray-400">Aguarde a próxima atualização do GitHub Actions</p>
            </div>
        </div>
        
        <!-- CICLO PAGE (Placeholder) -->
        <div class="page" id="page-ciclo">
            <div class="card text-center py-16">
                <i class="fas fa-sync-alt text-6xl text-gray-600 mb-6"></i>
                <h2 class="text-2xl font-bold mb-4">Ciclo Fundamentalista</h2>
                <p class="text-gray-400 mb-6">Este módulo será implementado em breve!</p>
                <p class="text-sm text-gray-500">Análise de ciclos e indicadores fundamentalistas</p>
            </div>
        </div>
        
        <!-- MANUAL PAGE -->
        <div class="page" id="page-blog">
            <div class="card mb-6">
                <h2 class="text-2xl font-bold mb-6">
                    <i class="fas fa-graduation-cap text-gold mr-3"></i>
                    Manual e Guias
                </h2>
                
                <div class="space-y-6">
                    <!-- Item 1 -->
                    <div class="border-b border-gray-800 pb-6">
                        <h3 class="text-lg font-semibold mb-3">📊 Sistema de Sinais</h3>
                        <p class="text-gray-400 mb-3">
                            Nossa plataforma utiliza 5 setups de análise técnica profissionais para identificar oportunidades de trading no mercado brasileiro.
                        </p>
                        <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                            <li>Larry Williams 9.1 - Exaustão de movimento</li>
                            <li>Rompimento de Suporte/Resistência</li>
                            <li>Golden/Death Cross - Cruzamento de médias</li>
                            <li>RSI - Sobrecompra e sobrevenda</li>
                            <li>Bollinger Bands - Reversão de bandas</li>
                        </ul>
                    </div>
                    
                    <!-- Item 2 -->
                    <div class="border-b border-gray-800 pb-6">
                        <h3 class="text-lg font-semibold mb-3">⭐ Sistema de Qualidade</h3>
                        <p class="text-gray-400 mb-3">
                            Cada sinal recebe um score de 0-100 baseado em múltiplos fatores técnicos:
                        </p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-gold mb-1">💎 PREMIUM</div>
                                <div class="text-gray-500">Score 80-100</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-blue-500 mb-1">⭐ BOM</div>
                                <div class="text-gray-500">Score 65-79</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-yellow-500 mb-1">⚡ REGULAR</div>
                                <div class="text-gray-500">Score 45-64</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-red-500 mb-1">⚠️ FRACO</div>
                                <div class="text-gray-500">Score 0-44</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item 3 -->
                    <div class="pb-6">
                        <h3 class="text-lg font-semibold mb-3">⚠️ Disclaimer</h3>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            As informações e os sinais disponibilizados nesta plataforma são gerados por um sistema automatizado 
                            com base em análise técnica e inteligência artificial, tendo caráter estritamente educacional. 
                            Não representam recomendação de compra, venda ou manutenção de ativos financeiros. 
                            As decisões de investimento são de inteira responsabilidade do investidor.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // CONFIGURAÇÃO DA API
        // ============================
        const API_URL = 'https://resenha-trader-v2-production.up.railway.app/api';
        
        let allSignals = [];
        let assimetriaData = {signals: [], resumo: {}};
        let assimetriaChart = null;
        let customTickers = [];
        let sortDirection = {};
        
        // ============================
        // NAVEGAÇÃO
        // ============================
        function navigateTo(page) {
            // Atualizar menu
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Atualizar páginas
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(`page-${page}`).classList.add('active');

            // Atualizar títulos
            const titles = {
                'home': ['Página Inicial', 'Visão geral do mercado'],
                'sinais': ['Sinais Trading', 'Todos os sinais disponíveis'],
                'assimetria': ['Assimetria', 'Análise de Z-Score e volatilidade'],
                'ciclo': ['Ciclo Fundamentalista', 'Indicadores fundamentalistas'],
                'blog': ['Manual', 'Guias e informações']
            };

            if (titles[page]) {
                document.getElementById('pageTitle').textContent = titles[page][0];
                document.getElementById('pageSubtitle').textContent = titles[page][1];
            }

            // Carregar dados de assimetria quando navegar para página
            if (page === 'assimetria' && assimetriaData.signals.length === 0) {
                loadAssimetriaData();
            }

            return false;
        }
        
        // Event listeners para navegação
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo(item.dataset.page);
            });
        });
        
        // ============================
        // SIDEBAR TOGGLE
        // ============================
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('mainContent').classList.toggle('expanded');
        }
        
        // ============================
        // CARREGAR DADOS - SINAIS TRADING
        // ============================
        async function carregarDados() {
            try {
                console.log('📄 Carregando dados da API...');
                
                const response = await fetch(`${API_URL}/sinais/`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const dados = await response.json();
                console.log('✅ Dados recebidos:', dados);
                
                allSignals = dados.signals || dados.sinais || [];
                
                if (dados.data) {
                    document.getElementById('lastUpdate').textContent = dados.data;
                }
                
                atualizarStats();
                renderizarTodosSinais();
                
            } catch (erro) {
                console.error('❌ Erro:', erro);
                document.getElementById('lastUpdate').textContent = 'Erro ao carregar';
            }
        }
        
        function atualizarStats() {
            const compras = allSignals.filter(s => (s.signal || '').toLowerCase().includes('compra')).length;
            const vendas = allSignals.filter(s => (s.signal || '').toLowerCase().includes('venda')).length;
            
            // Preencher dropdown de Setups dinamicamente
            const uniqueSetups = [...new Set(allSignals.map(s => s.setup))].sort();
            const filterSetup = document.getElementById('filterSetup');
            if (filterSetup) {
                filterSetup.innerHTML = '<option value="all">Todos os Setups</option>';
                uniqueSetups.forEach(setup => {
                    filterSetup.innerHTML += `<option value="${setup}">${setup}</option>`;
                });
            }
        }
        
        function renderizarTodosSinais() {
            const container = document.getElementById('allSignals');
            const searchTerm = (document.getElementById('searchTicker')?.value || '').toLowerCase();
            const filterSignal = document.getElementById('filterSignal')?.value || 'all';
            const filterQuality = document.getElementById('filterQuality')?.value || 'all';
            const filterSetup = document.getElementById('filterSetup')?.value || 'all';
            
            let filtered = allSignals.filter(s => {
                // Excluir tickers específicos
                const excludedTickers = ['CDI', 'US10TY', 'USD', 'CMDTY'];
                if (excludedTickers.includes(s.ticker)) return false;
                
                const matchSearch = !searchTerm || (s.ticker || '').toLowerCase().includes(searchTerm);
                const matchSignal = filterSignal === 'all' || s.signal === filterSignal;
                const matchQuality = filterQuality === 'all' || s.quality === filterQuality;
                const matchSetup = filterSetup === 'all' || s.setup === filterSetup;
                
                return matchSearch && matchSignal && matchQuality && matchSetup;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="col-span-3 text-center py-8 text-gray-500">Nenhum sinal encontrado</div>';
                return;
            }
            
            container.innerHTML = filtered.map(sinal => criarCardSinal(sinal)).join('');
        }
        
        function criarCardSinal(sinal) {
            const isCompra = (sinal.signal || '').toLowerCase().includes('compra');
            const badgeClass = isCompra ? 'badge-buy' : 'badge-sell';
            const icon = isCompra ? '▲' : '▼';
            
            // Filtrar tags excluídas
            const excludedTags = ['CDI', 'US10TY', 'USD', 'CMDTY'];
            const tags = (sinal.tags || []).filter(tag => !excludedTags.includes(tag));
            const tagsHTML = tags.map(tag => `<span class="badge text-xs bg-gray-700 text-gray-300 mr-1 mb-1">${tag}</span>`).join('');
            
            return `
                <div class="signal-card">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold">${sinal.ticker || 'N/A'}</h3>
                        <span class="badge ${badgeClass}">${icon} ${sinal.signal || 'N/A'}</span>
                    </div>
                    <div class="text-sm text-gray-400 mb-3">${sinal.setup || 'N/A'}</div>
                    <div class="text-2xl font-bold mb-3">R$ ${typeof sinal.ultimo === 'number' ? sinal.ultimo.toFixed(2) : sinal.ultimo}</div>
                    
                    <!-- Gain e Loss -->
                    <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-gray-400">Gain 1</div>
                            <div class="text-green-500 font-bold">${sinal.gain1 || 'N/A'}</div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-gray-400">Gain 2</div>
                            <div class="text-green-500 font-bold">${sinal.gain2 || 'N/A'}</div>
                        </div>
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-gray-400">Loss 1</div>
                            <div class="text-red-500 font-bold">${sinal.loss1 || 'N/A'}</div>
                        </div>
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-gray-400">Loss 2</div>
                            <div class="text-red-500 font-bold">${sinal.loss2 || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center text-sm mb-2">
                        <span class="text-gray-400">Score: <span class="font-bold text-white">${sinal.score || 0}</span></span>
                        <span class="badge ${sinal.score >= 80 ? 'badge-premium' : ''} text-xs">${sinal.quality || 'N/A'}</span>
                    </div>
                    
                    <!-- Tags -->
                    <div class="flex flex-wrap gap-1 mt-2">
                        ${tagsHTML}
                    </div>
                </div>
            `;
        }
        
        function clearTradingFilters() {
            document.getElementById('searchTicker').value = '';
            document.getElementById('filterSignal').value = 'all';
            document.getElementById('filterQuality').value = 'all';
            document.getElementById('filterSetup').value = 'all';
            renderizarTodosSinais();
        }
        
        function recarregarDados() {
            carregarDados();
            if (document.getElementById('page-home').classList.contains('active')) {
                loadHomeAssimetriaCard();
            }
        }
        
        // ============================
        // FUNÇÕES DE ASSIMETRIA
        // ============================
        async function loadAssimetriaData() {
            try {
                document.getElementById('assimetriaLoading').classList.remove('hidden');

                // Carregar dados completos
                const response = await fetch(`${API_URL}/assimetria/`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                console.log('✅ Dados de assimetria recebidos:', data);

                // Carregar resumo
                const resumoResponse = await fetch(`${API_URL}/assimetria/resumo`);
                const resumo = await resumoResponse.json();

                assimetriaData = {
                    signals: data.signals || [],
                    resumo: resumo
                };

                document.getElementById('assimetriaLoading').classList.add('hidden');

                if (assimetriaData.signals.length === 0) {
                    document.getElementById('assimetriaEmpty').classList.remove('hidden');
                } else {
                    document.getElementById('assimetriaEmpty').classList.add('hidden');
                    updateAssimetriaCards();
                    renderAssimetriaTable();
                    createAssimetriaChart();
                }
            } catch (error) {
                console.error('❌ Erro ao carregar dados de assimetria:', error);
                document.getElementById('assimetriaLoading').classList.add('hidden');
                document.getElementById('assimetriaEmpty').classList.remove('hidden');
            }
        }

        function updateAssimetriaCards() {
            const resumo = assimetriaData.resumo;
            document.getElementById('assimetria-total').textContent = resumo.total || 0;
            document.getElementById('assimetria-sobrecomprados').textContent = resumo.sobrecomprados || 0;
            document.getElementById('assimetria-sobrevendidos').textContent = resumo.sobrevendidos || 0;

            // Calcular críticas
            const criticas = assimetriaData.signals.filter(s => Math.abs(s.z_score) >= 3).length;
            document.getElementById('assimetria-criticas').textContent = criticas;
        }

        function renderAssimetriaTable(filteredData = null) {
            const tbody = document.getElementById('assimetriaTableBody');
            let data = filteredData || assimetriaData.signals;

            // Ordenação padrão: Z-Score descendente
            if (!filteredData) {
                data = [...data].sort((a, b) => Math.abs(b.z_score) - Math.abs(a.z_score));
            }

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            Nenhum sinal encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = data.map(signal => {
                const zscoreColor = Math.abs(signal.z_score) >= 3 ? 'text-orange-500' :
                                   Math.abs(signal.z_score) >= 2.5 ? 'text-gold' : 'text-white';
                const statusColor = signal.status === 'Sobrecomprado' ? 'text-blue-500' : 'text-red-500';

                return `
                    <tr class="border-b border-gray-800 hover:bg-gray-800/30 transition">
                        <td class="py-3 px-4 text-center font-bold text-white">
                            ${signal.ticker}
                        </td>
                        <td class="py-3 px-4 text-center text-white">
                            R$ ${signal.valor_atual.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center text-gray-400">
                            R$ ${signal.media_6m.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center font-bold ${zscoreColor}">
                            ${signal.z_score >= 0 ? '+' : ''}${signal.z_score.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center text-gray-300">
                            ${(signal.volatilidade_anualizada * 100).toFixed(1)}%
                        </td>
                        <td class="py-3 px-4 text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColor} bg-opacity-20">
                                ${signal.status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function createAssimetriaChart() {
            const canvas = document.getElementById('assimetriaChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // Destruir gráfico anterior se existir
            if (assimetriaChart) {
                assimetriaChart.destroy();
            }

            // Dados base
            const baseSignals = assimetriaData.signals;

            // Separar sobrecomprados e sobrevendidos
            const sobrecomprados = baseSignals.filter(s => s.status === 'Sobrecomprado');
            const sobrevendidos = baseSignals.filter(s => s.status === 'Sobrevendido');

            // Adicionar tickers customizados
            const customDataset = customTickers.map(ticker => {
                const signal = baseSignals.find(s => s.ticker.toUpperCase() === ticker.toUpperCase());
                if (signal) {
                    return {
                        x: signal.volatilidade_anualizada,
                        y: signal.z_score,
                        ticker: signal.ticker
                    };
                }
                return null;
            }).filter(d => d !== null);

            const datasets = [
                {
                    label: 'Sobrecompra',
                    data: sobrecomprados.map(s => ({
                        x: s.volatilidade_anualizada,
                        y: s.z_score,
                        ticker: s.ticker
                    })),
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'Sobrevenda',
                    data: sobrevendidos.map(s => ({
                        x: s.volatilidade_anualizada,
                        y: s.z_score,
                        ticker: s.ticker
                    })),
                    backgroundColor: 'rgba(239, 68, 68, 0.6)',
                    borderColor: 'rgba(239, 68, 68, 1)',
                    pointRadius: 6,
                    pointHoverRadius: 8
                }
            ];

            if (customDataset.length > 0) {
                datasets.push({
                    label: 'Customizados',
                    data: customDataset,
                    backgroundColor: 'rgba(156, 163, 175, 0.6)',
                    borderColor: 'rgba(156, 163, 175, 1)',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    pointStyle: 'triangle'
                });
            }

            assimetriaChart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#fff' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Ticker: ${point.ticker}`,
                                        `Z-Score: ${point.y.toFixed(2)}`,
                                        `Volatilidade: ${(point.x * 100).toFixed(1)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Volatilidade Anualizada',
                                color: '#fff'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            },
                            min: 0,
                            max: 0.6
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Z-Score (Desvios Padrão)',
                                color: '#fff'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#9ca3af' },
                            min: -4,
                            max: 4
                        }
                    }
                },
                plugins: [{
                    id: 'tickerLabels',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        ctx.save();
                        ctx.font = '10px Inter, sans-serif';
                        ctx.fillStyle = '#ffffff';
                        ctx.textAlign = 'left';
                        ctx.textBaseline = 'middle';

                        chart.data.datasets.forEach((dataset, datasetIndex) => {
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((point, index) => {
                                const ticker = dataset.data[index].ticker;
                                if (ticker) {
                                    ctx.fillText(ticker, point.x + 8, point.y);
                                }
                            });
                        });

                        ctx.restore();
                    }
                }, {
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const yAxis = chart.scales.y;
                        const xAxis = chart.scales.x;

                        ctx.save();
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([5, 5]);

                        // Linha y=0
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(0));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(0));
                        ctx.stroke();

                        // Linhas y=±2
                        ctx.strokeStyle = 'rgba(34, 197, 94, 0.5)';
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(2));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(2));
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(-2));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(-2));
                        ctx.stroke();

                        // Linhas y=±3
                        ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(3));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(3));
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(-3));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(-3));
                        ctx.stroke();

                        ctx.restore();
                    }
                }]
            });
        }

        function addCustomTickersToChart() {
            const input = document.getElementById('customTickersInput');
            const tickers = input.value.split(',').map(t => t.trim().toUpperCase()).filter(t => t);

            if (tickers.length === 0) {
                alert('Digite pelo menos um ticker. Exemplo: PETR4, VALE3');
                return;
            }

            // Verificar se os tickers existem nos dados
            const validTickers = tickers.filter(ticker => {
                return assimetriaData.signals.some(s => s.ticker.toUpperCase() === ticker);
            });

            if (validTickers.length === 0) {
                alert('Nenhum dos tickers digitados foi encontrado nos dados.');
                return;
            }

            customTickers = [...new Set([...customTickers, ...validTickers])];
            createAssimetriaChart();
            input.value = '';
            
            alert(`✅ ${validTickers.length} ticker(s) adicionado(s) ao gráfico!`);
        }

        function resetChart() {
            customTickers = [];
            createAssimetriaChart();
        }

        function applyAssimetriaFilters() {
            const tickerFilter = document.getElementById('filterTicker').value.toUpperCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const nivelFilter = document.getElementById('filterNivel').value;

            let filtered = assimetriaData.signals;

            if (tickerFilter) {
                filtered = filtered.filter(s => s.ticker.includes(tickerFilter));
            }

            if (statusFilter) {
                filtered = filtered.filter(s => s.status === statusFilter);
            }

            if (nivelFilter) {
                filtered = filtered.filter(s => s.nivel_oportunidade === nivelFilter);
            }

            renderAssimetriaTable(filtered);
        }
        
        function clearAssimetriaFilters() {
            document.getElementById('filterTicker').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterNivel').value = '';
            renderAssimetriaTable(assimetriaData.signals);
        }

        function sortAssimetriaTable(column) {
            if (!sortDirection[column]) {
                sortDirection[column] = 'asc';
            } else {
                sortDirection[column] = sortDirection[column] === 'asc' ? 'desc' : 'asc';
            }

            const sorted = [...assimetriaData.signals].sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (sortDirection[column] === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });

            renderAssimetriaTable(sorted);
        }
        
        // ============================
        // HOME - CARD DE ASSIMETRIA
        // ============================
        async function loadHomeAssimetriaCard() {
            try {
                const resumoResponse = await fetch(`${API_URL}/assimetria/resumo`);
                const resumo = await resumoResponse.json();
                
                document.getElementById('home-assimetria-total').textContent = resumo.total || 0;
                document.getElementById('home-assimetria-sobrecomprados').textContent = resumo.sobrecomprados || 0;
                document.getElementById('home-assimetria-sobrevendidos').textContent = resumo.sobrevendidos || 0;
                
                // Carregar dados completos para calcular críticas
                const response = await fetch(`${API_URL}/assimetria/`);
                const data = await response.json();
                const criticas = (data.signals || []).filter(s => Math.abs(s.z_score) >= 3).length;
                document.getElementById('home-assimetria-criticas').textContent = criticas;
            } catch (error) {
                console.error('Erro ao carregar dados de assimetria na Home:', error);
            }
        }
        
        // ============================
        // INICIALIZAÇÃO
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            carregarDados();
            loadHomeAssimetriaCard();

            // Event listeners para filtros de Trading
            ['searchTicker', 'filterSignal', 'filterQuality', 'filterSetup'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', renderizarTodosSinais);
                    el.addEventListener('change', renderizarTodosSinais);
                }
            });
        });
    </script>
</body>
</html>