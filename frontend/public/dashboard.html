<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resenha Trader - Dashboard Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': '#0a0a0a',
                        'dark-light': '#141414',
                        'dark-lighter': '#1a1a1a',
                        'gold': '#FFD700',
                        'gold-dark': '#FFA500',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            color: #fafafa;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #141414;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: linear-gradient(180deg, #141414 0%, #0a0a0a 100%);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            margin: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #9ca3af;
            text-decoration: none;
        }
        
        .sidebar-item:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1));
            color: #FFD700;
            font-weight: 600;
        }
        
        .sidebar-item i {
            font-size: 20px;
            width: 24px;
            margin-right: 16px;
            transition: all 0.3s;
        }
        
        .sidebar.collapsed .sidebar-item span {
            display: none;
        }
        
        .sidebar.collapsed .sidebar-item {
            justify-content: center;
            padding: 14px;
        }
        
        .sidebar.collapsed .sidebar-item i {
            margin-right: 0;
        }
        
        /* Main content */
        .main-content {
            margin-left: 280px;
            padding: 24px;
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        
        .main-content.expanded {
            margin-left: 80px;
        }
        
        /* Cards */
        .card {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 215, 0, 0.2);
        }
        
        /* Stats card */
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        /* Signal card */
        .signal-card {
            background: #141414;
            border: 1px solid #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .signal-card:hover {
            border-color: #FFD700;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.1);
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-buy {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-sell {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .badge-premium {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            color: #FFD700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Page transitions */
        .page {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Pulse animation for critical badges */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        .badge-critica {
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Glass effect from index.html */
        .glass {
            background: rgba(20, 20, 20, 0.7);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Card premium effect */
        .card-premium {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        /* Tag Pills from index.html */
        .tag-pill {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.2s;
            display: inline-block;
            border: 1px solid;
        }

        .tag-pill:hover {
            transform: scale(1.05);
        }

        .filter-active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1));
            border-color: #FFD700 !important;
            transform: scale(1.05);
        }

        /* Dropdown styles from index.html */
        .dropdown-custom {
            position: relative;
        }

        .dropdown-toggle {
            width: 100%;
            padding: 12px 40px 12px 16px;
            background: #1a1a1a;
            border: 1px solid #3f3f46;
            border-radius: 12px;
            color: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .dropdown-toggle:hover {
            border-color: #FFD700;
        }

        .dropdown-toggle.active {
            border-color: #FFD700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1);
        }

        .dropdown-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s;
            pointer-events: none;
        }

        .dropdown-icon.open {
            transform: translateY(-50%) rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #3f3f46;
            border-radius: 12px;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
        }

        .dropdown-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .dropdown-item.select-all {
            border-bottom: 1px solid #3f3f46;
            margin-bottom: 4px;
            padding-bottom: 12px;
            font-weight: 600;
        }

        .dropdown-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #3f3f46;
            border-radius: 4px;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .dropdown-checkbox.checked {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-color: #FFD700;
        }

        .dropdown-checkbox.checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #0a0a0a;
            font-weight: bold;
            font-size: 12px;
        }

        .dropdown-count {
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            color: #FFD700;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-gold to-gold-dark flex items-center justify-center">
                    <i class="fas fa-chart-line text-dark text-lg"></i>
                </div>
                <div class="sidebar-text">
                    <h1 class="text-lg font-bold text-white">Resenha Trader</h1>
                    <p class="text-xs text-gray-400">Trading Intelligence</p>
                </div>
            </div>
        </div>
        
        <!-- Menu -->
        <nav class="py-6">
            <a href="#" class="sidebar-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="sidebar-item" data-page="sinais">
                <i class="fas fa-signal"></i>
                <span>Sinais Trading</span>
            </a>
            <a href="#" class="sidebar-item" data-page="assimetria">
                <i class="fas fa-chart-area"></i>
                <span>Assimetria</span>
            </a>
            <a href="#" class="sidebar-item" data-page="ciclo">
                <i class="fas fa-sync-alt"></i>
                <span>Ciclo Fundamentalista</span>
            </a>
            <a href="#" class="sidebar-item" data-page="blog">
                <i class="fas fa-book"></i>
                <span>Manual</span>
            </a>
        </nav>
        
        <!-- Toggle button -->
        <div class="absolute bottom-6 left-0 right-0 px-4">
            <button onclick="toggleSidebar()" class="w-full py-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition flex items-center justify-center">
                <i class="fas fa-bars text-gray-400"></i>
            </button>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex-1 text-center">
                    <h1 class="text-3xl font-bold text-white mb-2" id="pageTitle">Visão Geral do Mercado</h1>
                    <p class="text-gray-400" id="pageSubtitle"></p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="card py-2 px-4">
                        <span class="text-xs text-gray-400">Última atualização:</span>
                        <span class="text-xs text-white font-medium ml-2" id="lastUpdate">Carregando...</span>
                    </div>
                    <button onclick="recarregarDados()" class="card py-2 px-4 hover:bg-gray-800">
                        <i class="fas fa-sync-alt text-gray-400 hover:text-gold transition"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- HOME PAGE -->
        <div class="page active" id="page-home">
            <!-- Cards de Resumo - Sinais Trading -->
            <div class="card mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-signal text-gold mr-3"></i>
                        Sinais Trading
                    </h2>
                    <a href="#" onclick="navigateTo('sinais'); return false;"
                       class="px-4 py-2 bg-gold text-dark font-medium rounded-lg hover:bg-gold-dark transition">
                        Ver Todos <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>

                <!-- Grid de cards de resumo -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Sinais Ativos -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-gold/20 to-gold-dark/10 flex items-center justify-center">
                                <i class="fas fa-signal text-gold text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-sinais-total">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400 mb-2">Sinais Ativos</h3>
                        <div class="flex items-center space-x-3 text-xs">
                            <span class="text-emerald-500" id="home-sinais-compra">▲ 0</span>
                            <span class="text-red-500" id="home-sinais-venda">▼ 0</span>
                        </div>
                    </div>

                    <!-- Por Qualidade -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-500/10 flex items-center justify-center">
                                <i class="fas fa-gem text-purple-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-sinais-quality-count">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400 mb-2">Por Qualidade</h3>
                        <div class="space-y-1 text-xs" id="home-sinais-quality"></div>
                    </div>

                    <!-- Por Tipo de Ativo -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center">
                                <i class="fas fa-chart-pie text-blue-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-sinais-asset-count">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400 mb-2">Por Tipo de Ativo</h3>
                        <div class="space-y-1 text-xs" id="home-sinais-assets"></div>
                    </div>

                    <!-- Por Setup -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-emerald-500/10 flex items-center justify-center">
                                <i class="fas fa-chart-line text-emerald-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-sinais-setup-count">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400 mb-2">Por Setup</h3>
                        <div class="space-y-1 text-xs" id="home-sinais-setups"></div>
                    </div>
                </div>
            </div>

            <!-- Card de Assimetria -->
            <div class="card mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-chart-area text-blue-500 mr-3"></i>
                        Análise de Assimetria (Z-Score)
                    </h2>
                    <a href="#" onclick="navigateTo('assimetria'); return false;" 
                       class="px-4 py-2 bg-gold text-dark font-medium rounded-lg hover:bg-gold-dark transition">
                        Ver todos <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                
                <!-- Grid de cards de resumo -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Total -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center">
                                <i class="fas fa-chart-area text-blue-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-total">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Total de Sinais</h3>
                    </div>

                    <!-- Sobrecompra -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600/20 to-blue-600/10 flex items-center justify-center">
                                <i class="fas fa-arrow-down text-blue-600 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-sobrecomprados">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sobrecompra ↓</h3>
                        <div class="text-xs text-gray-500">Acima da média</div>
                    </div>

                    <!-- Sobrevenda -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500/20 to-red-500/10 flex items-center justify-center">
                                <i class="fas fa-arrow-up text-red-500 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-sobrevendidos">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sobrevenda ↑</h3>
                        <div class="text-xs text-gray-500">Abaixo da média</div>
                    </div>

                    <!-- Críticas -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-600/20 to-orange-600/10 flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-orange-600 text-xl"></i>
                            </div>
                            <span class="text-3xl font-bold" id="home-assimetria-criticas">-</span>
                        </div>
                        <h3 class="text-sm text-gray-400">Sinais Críticos (±3σ)</h3>
                        <div class="text-xs text-gray-500">Desvios extremos</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SINAIS PAGE -->
        <div class="page" id="page-sinais">
            <div class="card mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="fas fa-sliders-h text-gold mr-3"></i>
                        Filtros Inteligentes
                    </h2>
                </div>

                <div id="filtersContainer">
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                        <div class="col-span-2">
                            <label class="block text-sm font-semibold text-gray-300 mb-3">Buscar Ticker</label>
                            <div class="relative">
                                <input type="text"
                                       id="searchTicker"
                                       placeholder="Digite o ticker..."
                                       class="w-full px-4 py-3 bg-dark-lighter border border-gray-border rounded-xl text-white placeholder-gray-500 focus:border-gold focus:outline-none transition-all font-medium">
                                <i class="fas fa-search absolute right-4 top-4 text-gray-500"></i>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-3">Tipo de Sinal</label>
                            <select id="filterSignal" class="w-full px-4 py-3 bg-dark-lighter border border-gray-border rounded-xl text-white focus:border-gold focus:outline-none transition-all font-medium">
                                <option value="all">Todos</option>
                                <option value="Compra">▲ Compra</option>
                                <option value="Venda">▼ Venda</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-3">Tipo de Ativo</label>
                            <div class="dropdown-custom">
                                <button type="button" class="dropdown-toggle" id="assetTypeDropdownToggle" onclick="toggleDropdown('assetType')">
                                    <span id="assetTypeDropdownText">Todos os tipos</span>
                                    <i class="fas fa-chevron-down dropdown-icon" id="assetTypeDropdownIcon"></i>
                                </button>
                                <div class="dropdown-menu" id="assetTypeDropdownMenu"></div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-3">Qualidade</label>
                            <div class="dropdown-custom">
                                <button type="button" class="dropdown-toggle" id="qualityDropdownToggle" onclick="toggleDropdown('quality')">
                                    <span id="qualityDropdownText">Todas as qualidades</span>
                                    <i class="fas fa-chevron-down dropdown-icon" id="qualityDropdownIcon"></i>
                                </button>
                                <div class="dropdown-menu" id="qualityDropdownMenu"></div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-3">Setups</label>
                            <div class="dropdown-custom">
                                <button type="button" class="dropdown-toggle" id="setupDropdownToggle" onclick="toggleDropdown('setup')">
                                    <span id="setupDropdownText">Todos os setups</span>
                                    <i class="fas fa-chevron-down dropdown-icon" id="setupDropdownIcon"></i>
                                </button>
                                <div class="dropdown-menu" id="setupDropdownMenu"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-300 mb-3">Filtros Rápidos</label>
                        <div class="flex flex-wrap gap-2" id="quickFilters"></div>
                    </div>

                    <div class="flex items-center flex-wrap gap-2 pt-4 border-t border-gray-border" id="activeFiltersDisplay">
                        <span class="text-xs text-gray-400">Filtros ativos:</span>
                        <span class="text-xs text-gray-500 italic">Nenhum filtro aplicado</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="allSignals">
                <div class="text-center py-8 text-gray-500">
                    <div class="loading mx-auto mb-4"></div>
                    <p>Carregando sinais...</p>
                </div>
            </div>
        </div>
        
        <!-- ASSIMETRIA PAGE -->
        <div class="page" id="page-assimetria">
            <!-- Header -->
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white mb-2">Assimetria (Z-Score)</h2>
                <p class="text-gray-400">Análise de distância da média móvel de 6 meses em desvios padrão</p>
            </div>

            <!-- Cards de Resumo -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center">
                            <i class="fas fa-chart-area text-blue-500 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-total">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Total de Sinais</h3>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600/20 to-blue-600/10 flex items-center justify-center">
                            <i class="fas fa-arrow-down text-blue-600 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-sobrecomprados">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sobrecompra ↓</h3>
                    <div class="text-xs text-gray-500">Acima da média</div>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500/20 to-red-500/10 flex items-center justify-center">
                            <i class="fas fa-arrow-up text-red-500 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-sobrevendidos">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sobrevenda ↑</h3>
                    <div class="text-xs text-gray-500">Abaixo da média</div>
                </div>

                <div class="card stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-600/20 to-orange-600/10 flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-orange-600 text-xl"></i>
                        </div>
                        <span class="text-3xl font-bold" id="assimetria-criticas">-</span>
                    </div>
                    <h3 class="text-sm text-gray-400">Sinais Críticos (±3σ)</h3>
                    <div class="text-xs text-gray-500">Desvios extremos</div>
                </div>
            </div>

            <!-- Gráfico de Dispersão -->
            <div class="card mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gráfico de Dispersão</h3>
                    <div class="text-sm">
                        <span class="text-blue-500">● Sobrecompra</span>
                        <span class="text-red-500 ml-4">● Sobrevenda</span>
                    </div>
                </div>

                <div class="relative bg-gray-900 rounded-lg p-4" style="height: 400px;">
                    <canvas id="assimetriaChart"></canvas>
                </div>

                <!-- Controles do gráfico -->
                <div class="flex items-center gap-4 mt-4">
                    <input type="text" id="customTickersInput" placeholder="PETR4, VALE3..."
                           class="flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                    <button onclick="addCustomTickersToChart()"
                            class="px-4 py-2 bg-gold text-dark font-medium rounded-lg hover:bg-gold-dark transition">
                        Adicionar ao Gráfico
                    </button>
                    <button onclick="resetChart()"
                            class="px-4 py-2 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-600 transition">
                        Reset (Apenas ±2σ)
                    </button>
                </div>

                <div class="text-xs text-gray-500 mt-2">
                    💡 Adicione tickers customizados ao gráfico separados por vírgula
                </div>
            </div>

            <!-- Filtros -->
            <div class="card mb-6">
                <h3 class="text-lg font-bold mb-4">Filtros</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="filterTicker" placeholder="Buscar ticker..." oninput="applyAssimetriaFilters()"
                           class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">

                    <select id="filterStatus" onchange="applyAssimetriaFilters()"
                            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="">Todos os Status</option>
                        <option value="Sobrecomprado">Sobrecompra</option>
                        <option value="Sobrevendido">Sobrevenda</option>
                    </select>

                    <select id="filterNivel" onchange="applyAssimetriaFilters()"
                            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-gold focus:outline-none">
                        <option value="">Todos os Níveis</option>
                        <option value="Crítica">🔴 Crítica</option>
                        <option value="Alta">🟨 Alta</option>
                        <option value="Moderada">🟦 Moderada</option>
                    </select>
                    
                    <button onclick="clearAssimetriaFilters()" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-lg transition">
                        <i class="fas fa-times mr-2"></i>Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Tabela de Assimetria -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">Tabela de Assimetria</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('ticker')">
                                    Ticker <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('valor_atual')">
                                    Valor Atual <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('media_6m')">
                                    Média 6M <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('z_score')">
                                    Z-Score <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium cursor-pointer hover:text-gold" onclick="sortAssimetriaTable('volatilidade_anualizada')">
                                    Volatilidade <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-center py-3 px-4 text-gray-400 font-medium">
                                    Status
                                </th>
                            </tr>
                        </thead>
                        <tbody id="assimetriaTableBody">
                            <tr>
                                <td colspan="6" class="text-center py-8">
                                    <div class="loading mx-auto mb-4"></div>
                                    <p class="text-gray-500">Carregando dados...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Loading State -->
            <div id="assimetriaLoading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="card p-8 text-center">
                    <div class="loading mx-auto mb-4"></div>
                    <p class="text-white">Carregando dados de assimetria...</p>
                </div>
            </div>

            <!-- Empty State -->
            <div id="assimetriaEmpty" class="hidden card text-center py-16">
                <i class="fas fa-chart-area text-6xl text-gray-600 mb-6"></i>
                <h3 class="text-xl font-bold mb-2">Nenhum sinal de assimetria disponível</h3>
                <p class="text-gray-400">Aguarde a próxima atualização do GitHub Actions</p>
            </div>
        </div>
        
        <!-- CICLO PAGE (Placeholder) -->
        <div class="page" id="page-ciclo">
            <div class="card text-center py-16">
                <i class="fas fa-sync-alt text-6xl text-gray-600 mb-6"></i>
                <h2 class="text-2xl font-bold mb-4">Ciclo Fundamentalista</h2>
                <p class="text-gray-400 mb-6">Este módulo será implementado em breve!</p>
                <p class="text-sm text-gray-500">Análise de ciclos e indicadores fundamentalistas</p>
            </div>
        </div>
        
        <!-- MANUAL PAGE -->
        <div class="page" id="page-blog">
            <div class="card mb-6">
                <h2 class="text-2xl font-bold mb-6">
                    <i class="fas fa-graduation-cap text-gold mr-3"></i>
                    Manual e Guias
                </h2>
                
                <div class="space-y-6">
                    <!-- Item 1 -->
                    <div class="border-b border-gray-800 pb-6">
                        <h3 class="text-lg font-semibold mb-3">📊 Sistema de Sinais</h3>
                        <p class="text-gray-400 mb-3">
                            Nossa plataforma utiliza 5 setups de análise técnica profissionais para identificar oportunidades de trading no mercado brasileiro.
                        </p>
                        <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                            <li>Larry Williams 9.1 - Exaustão de movimento</li>
                            <li>Rompimento de Suporte/Resistência</li>
                            <li>Golden/Death Cross - Cruzamento de médias</li>
                            <li>RSI - Sobrecompra e sobrevenda</li>
                            <li>Bollinger Bands - Reversão de bandas</li>
                        </ul>
                    </div>
                    
                    <!-- Item 2 -->
                    <div class="border-b border-gray-800 pb-6">
                        <h3 class="text-lg font-semibold mb-3">⭐ Sistema de Qualidade</h3>
                        <p class="text-gray-400 mb-3">
                            Cada sinal recebe um score de 0-100 baseado em múltiplos fatores técnicos:
                        </p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-gold mb-1">💎 PREMIUM</div>
                                <div class="text-gray-500">Score 80-100</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-blue-500 mb-1">⭐ BOM</div>
                                <div class="text-gray-500">Score 65-79</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-yellow-500 mb-1">⚡ REGULAR</div>
                                <div class="text-gray-500">Score 45-64</div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <div class="text-red-500 mb-1">⚠️ FRACO</div>
                                <div class="text-gray-500">Score 0-44</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item 3 -->
                    <div class="pb-6">
                        <h3 class="text-lg font-semibold mb-3">⚠️ Disclaimer</h3>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            As informações e os sinais disponibilizados nesta plataforma são gerados por um sistema automatizado 
                            com base em análise técnica e inteligência artificial, tendo caráter estritamente educacional. 
                            Não representam recomendação de compra, venda ou manutenção de ativos financeiros. 
                            As decisões de investimento são de inteira responsabilidade do investidor.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // CONFIGURAÇÃO DA API
        // ============================
        const API_URL = 'https://resenha-trader-v2-production.up.railway.app/api';
        
        let allSignals = [];
        let assimetriaData = {signals: [], resumo: {}};
        let assimetriaChart = null;
        let customTickers = [];
        let sortDirection = {};
        
        // ============================
        // NAVEGAÇÃO
        // ============================
        function navigateTo(page) {
            // Atualizar menu
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Atualizar páginas
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(`page-${page}`).classList.add('active');

            // Atualizar títulos
            const titles = {
                'home': ['Visão Geral do Mercado', ''],
                'sinais': ['Sinais Trading', 'Todos os sinais disponíveis'],
                'assimetria': ['Assimetria', 'Análise de Z-Score e volatilidade'],
                'ciclo': ['Ciclo Fundamentalista', 'Indicadores fundamentalistas'],
                'blog': ['Manual', 'Guias e informações']
            };

            if (titles[page]) {
                document.getElementById('pageTitle').textContent = titles[page][0];
                document.getElementById('pageSubtitle').textContent = titles[page][1];
            }

            // Carregar dados de assimetria quando navegar para página
            if (page === 'assimetria' && assimetriaData.signals.length === 0) {
                loadAssimetriaData();
            }

            return false;
        }
        
        // Event listeners para navegação
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo(item.dataset.page);
            });
        });
        
        // ============================
        // SIDEBAR TOGGLE
        // ============================
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('mainContent').classList.toggle('expanded');
        }
        
        // ============================
        // CARREGAR DADOS - SINAIS TRADING
        // ============================
        async function carregarDados() {
            try {
                console.log('📄 Carregando dados da API...');
                
                const response = await fetch(`${API_URL}/sinais/`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const dados = await response.json();
                console.log('✅ Dados recebidos:', dados);
                
                allSignals = dados.signals || dados.sinais || [];
                
                if (dados.data) {
                    document.getElementById('lastUpdate').textContent = dados.data;
                }
                
                atualizarStats();
                renderizarTodosSinais();
                
            } catch (erro) {
                console.error('❌ Erro:', erro);
                document.getElementById('lastUpdate').textContent = 'Erro ao carregar';
            }
        }
        
        function atualizarStats() {
            // Atualizar cards de resumo da home
            updateHomeSinaisCards();

            // Inicializar dropdowns
            initializeDropdowns();
        }

        function updateHomeSinaisCards() {
            // Total de sinais
            document.getElementById('home-sinais-total').textContent = allSignals.length;

            // Compras e Vendas
            const compras = allSignals.filter(s => (s.signal || '').toLowerCase().includes('compra')).length;
            const vendas = allSignals.filter(s => (s.signal || '').toLowerCase().includes('venda')).length;
            document.getElementById('home-sinais-compra').textContent = `▲ ${compras}`;
            document.getElementById('home-sinais-venda').textContent = `▼ ${vendas}`;

            // Por Qualidade
            const qualityCounts = {};
            allSignals.forEach(s => {
                qualityCounts[s.quality] = (qualityCounts[s.quality] || 0) + 1;
            });
            const qualityOrder = ['PREMIUM', 'BOM', 'REGULAR', 'FRACO'];
            const qualityIcons = {'PREMIUM': '💎', 'BOM': '⭐', 'REGULAR': '⚡', 'FRACO': '⚠️'};
            const qualityColors = {
                'PREMIUM': 'text-gold',
                'BOM': 'text-blue-500',
                'REGULAR': 'text-yellow-500',
                'FRACO': 'text-red-500'
            };

            let qualityHTML = '';
            let qualityTotal = 0;
            qualityOrder.forEach(quality => {
                if (qualityCounts[quality]) {
                    qualityTotal++;
                    const icon = qualityIcons[quality] || '';
                    const color = qualityColors[quality] || 'text-gray-400';
                    qualityHTML += `<div class="${color}">${icon} ${quality}: ${qualityCounts[quality]}</div>`;
                }
            });
            document.getElementById('home-sinais-quality').innerHTML = qualityHTML || '<div class="text-gray-500">Nenhum</div>';
            document.getElementById('home-sinais-quality-count').textContent = qualityTotal;

            // Por Tipo de Ativo
            const assetCounts = {};
            allSignals.forEach(s => {
                const tags = s.tags || '';
                if (tags.includes('Ação')) assetCounts['Ação'] = (assetCounts['Ação'] || 0) + 1;
                if (tags.includes('BDR')) assetCounts['BDR'] = (assetCounts['BDR'] || 0) + 1;
                if (tags.includes('ETF')) assetCounts['ETF'] = (assetCounts['ETF'] || 0) + 1;
            });

            const assetColors = {
                'Ação': 'text-blue-400',
                'BDR': 'text-indigo-400',
                'ETF': 'text-sky-400'
            };

            let assetHTML = '';
            let assetTotal = 0;
            Object.entries(assetCounts).forEach(([asset, count]) => {
                assetTotal++;
                const color = assetColors[asset] || 'text-gray-400';
                assetHTML += `<div class="${color}">${asset}: ${count}</div>`;
            });
            document.getElementById('home-sinais-assets').innerHTML = assetHTML || '<div class="text-gray-500">Nenhum</div>';
            document.getElementById('home-sinais-asset-count').textContent = assetTotal;

            // Por Setup (top 3)
            const setupCounts = {};
            allSignals.forEach(s => {
                setupCounts[s.setup] = (setupCounts[s.setup] || 0) + 1;
            });

            const topSetups = Object.entries(setupCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            let setupHTML = '';
            topSetups.forEach(([setup, count]) => {
                setupHTML += `<div class="text-gray-300">${setup}: ${count}</div>`;
            });
            document.getElementById('home-sinais-setups').innerHTML = setupHTML || '<div class="text-gray-500">Nenhum</div>';
            document.getElementById('home-sinais-setup-count').textContent = Object.keys(setupCounts).length;
        }
        
        function renderizarTodosSinais() {
            const container = document.getElementById('allSignals');
            const searchTerm = (document.getElementById('searchTicker')?.value || '').toLowerCase();
            const filterSignal = document.getElementById('filterSignal')?.value || 'all';

            let filtered = allSignals.filter(s => {
                // Excluir tickers específicos
                const excludedTickers = ['CDI', 'US10TY', 'USD', 'CMDTY'];
                if (excludedTickers.includes(s.ticker)) return false;

                // Filtro de busca
                const matchSearch = !searchTerm || (s.ticker || '').toLowerCase().includes(searchTerm);

                // Filtro de sinal (Compra/Venda)
                const matchSignal = filterSignal === 'all' || s.signal === filterSignal;

                // Filtro de qualidade (dropdown)
                const matchQuality = selectedQualities.length === 0 || selectedQualities.includes(s.quality);

                // Filtro de setup (dropdown)
                const matchSetup = selectedSetups.length === 0 || selectedSetups.includes(s.setup);

                // Filtro de tipo de ativo (dropdown)
                let matchAssetType = true;
                if (selectedAssetTypes.length > 0) {
                    const tags = s.tags || '';
                    matchAssetType = selectedAssetTypes.some(type => tags.includes(type));
                }

                // Filtros rápidos (tags)
                let matchQuickFilters = true;
                if (activeQuickFilters.length > 0) {
                    const tags = (s.tags || '').split(' ');
                    matchQuickFilters = activeQuickFilters.every(filter => tags.includes(filter));
                }

                return matchSearch && matchSignal && matchQuality && matchSetup && matchAssetType && matchQuickFilters;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="col-span-3 text-center py-8 text-gray-500">Nenhum sinal encontrado</div>';
                return;
            }

            container.innerHTML = filtered.map(sinal => criarCardSinal(sinal)).join('');
        }
        
        function criarCardSinal(sinal) {
            const isCompra = (sinal.signal || '').toLowerCase().includes('compra');
            const signalColor = isCompra ? 'emerald-500' : 'red';
            const signalIcon = isCompra ? 'arrow-up' : 'arrow-down';

            // Formatar valores monetários
            const formatCurrency = (value) => {
                if (!value || value === 'N/A') return 'N/A';
                const num = parseFloat(value);
                if (isNaN(num)) return value;
                return `R$ ${num.toFixed(2)}`;
            };

            // Calcular variação percentual
            const calcPercentChange = (current, target) => {
                if (!current || !target || current === 'N/A' || target === 'N/A') return '';
                const currentNum = parseFloat(current);
                const targetNum = parseFloat(target);
                if (isNaN(currentNum) || isNaN(targetNum)) return '';
                const percent = ((targetNum - currentNum) / currentNum) * 100;
                return ` (${percent >= 0 ? '+' : ''}${percent.toFixed(1)}%)`;
            };

            const ultimo = parseFloat(sinal.ultimo);

            // Filtrar e processar tags (excluir CDI0, US10YT0, USD0, CMDTY0, nan)
            const excludedPatterns = ['CDI0', 'US10YT0', 'USD0', 'CMDTY0', 'nan'];
            const allTags = (sinal.tags || '').split(' ').filter(tag =>
                tag && !excludedPatterns.some(pattern => tag.includes(pattern))
            );

            const tagsHTML = allTags.map(tag => {
                const tagClass = getTagClass(tag);
                return `<span class="tag-pill ${tagClass}">${tag}</span>`;
            }).join('');

            // Tipo de ativo
            let assetType = '';
            if (sinal.tags?.includes('Ação')) assetType = 'Ação';
            else if (sinal.tags?.includes('BDR')) assetType = 'BDR';
            else if (sinal.tags?.includes('ETF')) assetType = 'ETF';

            const assetTypeColors = {
                'Ação': 'bg-blue-600/20 text-blue-400 border-blue-600/30',
                'BDR': 'bg-indigo-600/20 text-indigo-400 border-indigo-600/30',
                'ETF': 'bg-sky-600/20 text-sky-400 border-sky-600/30'
            };
            const assetTypeClass = assetTypeColors[assetType] || '';

            // Score color
            const getScoreColorClass = (score) => {
                if (score >= 80) return 'bg-emerald-500/20 text-emerald-500';
                if (score >= 65) return 'bg-blue-500/20 text-blue-500';
                if (score >= 45) return 'bg-yellow-500/20 text-yellow-500';
                return 'bg-red/20 text-red';
            };

            return `
                <div class="glass rounded-2xl p-5 card-premium">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold font-display text-white mb-1">${sinal.ticker || 'N/A'}</h3>
                            <p class="text-xs text-gray-400">${sinal.setup || 'N/A'}</p>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            <span class="text-xs px-2 py-1 rounded-full bg-${signalColor}/20 text-${signalColor} font-semibold">
                                <i class="fas fa-${signalIcon} mr-1"></i>${sinal.signal || 'N/A'}
                            </span>
                            ${assetType ? `<span class="tag-pill ${assetTypeClass}">${assetType}</span>` : ''}
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="text-xs text-gray-500 mb-1">Último Preço</div>
                        <div class="text-2xl font-bold font-display text-white">${formatCurrency(sinal.ultimo)}</div>
                        <div class="text-xs mt-1">
                            <span class="px-2 py-1 rounded ${getScoreColorClass(sinal.score)} font-semibold">
                                Score: ${sinal.score || 0}
                            </span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="bg-emerald-500/10 rounded-lg p-3 border border-emerald-500/20">
                            <div class="text-xs text-emerald-500 mb-2 font-semibold">
                                <i class="fas fa-bullseye mr-1"></i> Alvos
                            </div>
                            <div class="space-y-1">
                                <div class="text-xs text-gray-300">${formatCurrency(sinal.gain1)}${calcPercentChange(sinal.ultimo, sinal.gain1)}</div>
                                ${sinal.gain2 !== 'N/A' ? `<div class="text-xs text-gray-300">${formatCurrency(sinal.gain2)}${calcPercentChange(sinal.ultimo, sinal.gain2)}</div>` : ''}
                            </div>
                        </div>
                        <div class="bg-red/10 rounded-lg p-3 border border-red/20">
                            <div class="text-xs text-red mb-2 font-semibold">
                                <i class="fas fa-shield-alt mr-1"></i> Proteção
                            </div>
                            <div class="space-y-1">
                                <div class="text-xs text-gray-300">${formatCurrency(sinal.loss1)}${calcPercentChange(sinal.ultimo, sinal.loss1)}</div>
                                ${sinal.loss2 !== 'N/A' ? `<div class="text-xs text-gray-300">${formatCurrency(sinal.loss2)}${calcPercentChange(sinal.ultimo, sinal.loss2)}</div>` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-800 pt-3">
                        <div class="flex flex-wrap gap-2">
                            ${tagsHTML}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ============================
        // FILTROS INTELIGENTES - VARIÁVEIS GLOBAIS
        // ============================
        let selectedAssetTypes = [];
        let selectedQualities = [];
        let selectedSetups = [];
        let activeQuickFilters = [];

        // ============================
        // FUNÇÕES DE TAG E FILTROS
        // ============================
        function getTagClass(tag) {
            const classes = {
                'ALTA': 'bg-emerald-500/20 text-emerald-500 border-emerald-500/30',
                'BAIXA': 'bg-red/20 text-red border-red/30',
                'LATERAL': 'bg-yellow-500/20 text-yellow-500 border-yellow-500/30',
                'VOL+': 'bg-orange-500/20 text-orange-500 border-orange-500/30',
                'VOL-': 'bg-orange-500/10 text-orange-500/70 border-orange-500/20',
                'RSI+': 'bg-teal-500/20 text-teal-400 border-teal-500/30',
                'RSI-': 'bg-rose-500/20 text-rose-400 border-rose-500/30'
            };

            if (tag.startsWith('RSI') && !tag.includes('+') && !tag.includes('-')) {
                const value = parseInt(tag.replace('RSI', ''));
                if (value > 70) return 'bg-red/20 text-red border-red/30';
                if (value < 30) return 'bg-emerald-500/20 text-emerald-500 border-emerald-500/30';
                return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/30';
            }

            return classes[tag] || 'bg-gray-600/20 text-gray-400 border-gray-600/30';
        }

        // Inicializar dropdowns
        function initializeDropdowns() {
            initializeAssetTypeDropdown();
            initializeQualityDropdown();
            initializeSetupDropdown();
            renderQuickFilters();
        }

        function initializeAssetTypeDropdown() {
            const assetCounts = {};
            allSignals.forEach(s => {
                const tags = s.tags || '';
                if (tags.includes('Ação')) assetCounts['Ação'] = (assetCounts['Ação'] || 0) + 1;
                if (tags.includes('BDR')) assetCounts['BDR'] = (assetCounts['BDR'] || 0) + 1;
                if (tags.includes('ETF')) assetCounts['ETF'] = (assetCounts['ETF'] || 0) + 1;
            });

            const dropdownMenu = document.getElementById('assetTypeDropdownMenu');
            if (!dropdownMenu) return;

            let html = `
                <div class="dropdown-item select-all" onclick="toggleAllAssetTypes(event)">
                    <div class="dropdown-checkbox" id="selectAllAssetTypeCheckbox"></div>
                    <span>Todos os tipos</span>
                    <span class="dropdown-count">${Object.keys(assetCounts).length}</span>
                </div>
            `;

            Object.entries(assetCounts).forEach(([assetType, count]) => {
                html += `
                    <div class="dropdown-item" onclick="toggleAssetType(event, '${assetType}')">
                        <div class="dropdown-checkbox" id="assetType_${assetType}"></div>
                        <span>${assetType}</span>
                        <span class="dropdown-count">${count}</span>
                    </div>
                `;
            });

            dropdownMenu.innerHTML = html;
        }

        function initializeQualityDropdown() {
            const qualityCounts = {};
            allSignals.forEach(s => {
                qualityCounts[s.quality] = (qualityCounts[s.quality] || 0) + 1;
            });

            const dropdownMenu = document.getElementById('qualityDropdownMenu');
            if (!dropdownMenu) return;

            const qualityOrder = ['PREMIUM', 'BOM', 'REGULAR', 'FRACO'];
            const qualityIcons = {'PREMIUM': '💎', 'BOM': '⭐', 'REGULAR': '⚡', 'FRACO': '⚠️'};

            let html = `
                <div class="dropdown-item select-all" onclick="toggleAllQualities(event)">
                    <div class="dropdown-checkbox" id="selectAllQualityCheckbox"></div>
                    <span>Todas as qualidades</span>
                    <span class="dropdown-count">${Object.keys(qualityCounts).length}</span>
                </div>
            `;

            qualityOrder.forEach(quality => {
                if (qualityCounts[quality]) {
                    const icon = qualityIcons[quality];
                    html += `
                        <div class="dropdown-item" onclick="toggleQuality(event, '${quality}')">
                            <div class="dropdown-checkbox" id="quality_${quality}"></div>
                            <span>${icon} ${quality}</span>
                            <span class="dropdown-count">${qualityCounts[quality]}</span>
                        </div>
                    `;
                }
            });

            dropdownMenu.innerHTML = html;
        }

        function initializeSetupDropdown() {
            const setupCounts = {};
            allSignals.forEach(s => {
                setupCounts[s.setup] = (setupCounts[s.setup] || 0) + 1;
            });

            const dropdownMenu = document.getElementById('setupDropdownMenu');
            if (!dropdownMenu) return;

            let html = `
                <div class="dropdown-item select-all" onclick="toggleAllSetups(event)">
                    <div class="dropdown-checkbox" id="selectAllSetupCheckbox"></div>
                    <span>Todos os setups</span>
                    <span class="dropdown-count">${Object.keys(setupCounts).length}</span>
                </div>
            `;

            Object.entries(setupCounts).forEach(([setup, count]) => {
                const setupId = setup.replace(/\s+/g, '_').replace(/\./g, '_');
                html += `
                    <div class="dropdown-item" onclick="toggleSetup(event, '${setup}')">
                        <div class="dropdown-checkbox" id="setup_${setupId}"></div>
                        <span>${setup}</span>
                        <span class="dropdown-count">${count}</span>
                    </div>
                `;
            });

            dropdownMenu.innerHTML = html;
        }

        function renderQuickFilters() {
            const quickFiltersContainer = document.getElementById('quickFilters');
            if (!quickFiltersContainer) return;

            // Tags excluídas: Ação, BDR, ETF, DOM, EXP
            const excludedTags = ['Ação', 'BDR', 'ETF', 'DOM', 'EXP'];

            const allTags = {};
            allSignals.forEach(signal => {
                const tags = (signal.tags || '').split(' ').filter(t => t && !excludedTags.includes(t));
                tags.forEach(tag => {
                    if (!tag.startsWith('CDI') && !tag.startsWith('US10YT') && !tag.startsWith('USD') && !tag.startsWith('CMDTY') && tag !== 'nan') {
                        allTags[tag] = (allTags[tag] || 0) + 1;
                    }
                });
            });

            const tagsToShow = ['ALTA', 'BAIXA', 'LATERAL', 'VOL+', 'VOL-', 'RSI+', 'RSI-'];
            let html = '';

            tagsToShow.forEach(tag => {
                if (allTags[tag]) {
                    const tagClass = getTagClass(tag);
                    const isActive = activeQuickFilters.includes(tag) ? 'filter-active' : '';
                    html += `
                        <button class="tag-pill ${tagClass} ${isActive} cursor-pointer" onclick="toggleQuickFilter('${tag}')">
                            ${tag}
                        </button>
                    `;
                }
            });

            quickFiltersContainer.innerHTML = html || '<span class="text-xs text-gray-500">Nenhum filtro disponível</span>';
        }

        function toggleQuickFilter(tag) {
            const index = activeQuickFilters.indexOf(tag);
            if (index > -1) {
                activeQuickFilters.splice(index, 1);
            } else {
                activeQuickFilters.push(tag);
            }
            renderQuickFilters();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleDropdown(type) {
            const menu = document.getElementById(`${type}DropdownMenu`);
            const icon = document.getElementById(`${type}DropdownIcon`);
            const toggle = document.getElementById(`${type}DropdownToggle`);

            // Fechar outros dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m !== menu) m.classList.remove('show');
            });
            document.querySelectorAll('.dropdown-icon').forEach(i => {
                if (i !== icon) i.classList.remove('open');
            });
            document.querySelectorAll('.dropdown-toggle').forEach(t => {
                if (t !== toggle) t.classList.remove('active');
            });

            // Toggle atual
            menu.classList.toggle('show');
            icon.classList.toggle('open');
            toggle.classList.toggle('active');
        }

        function toggleAssetType(event, assetType) {
            event.stopPropagation();
            const checkbox = document.getElementById(`assetType_${assetType}`);
            const index = selectedAssetTypes.indexOf(assetType);

            if (index > -1) {
                selectedAssetTypes.splice(index, 1);
                checkbox.classList.remove('checked');
            } else {
                selectedAssetTypes.push(assetType);
                checkbox.classList.add('checked');
            }

            updateAssetTypeDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleAllAssetTypes(event) {
            event.stopPropagation();
            const assetCounts = {};
            allSignals.forEach(s => {
                const tags = s.tags || '';
                if (tags.includes('Ação')) assetCounts['Ação'] = true;
                if (tags.includes('BDR')) assetCounts['BDR'] = true;
                if (tags.includes('ETF')) assetCounts['ETF'] = true;
            });

            const allAssetTypes = Object.keys(assetCounts);
            const checkbox = document.getElementById('selectAllAssetTypeCheckbox');

            if (selectedAssetTypes.length === allAssetTypes.length) {
                selectedAssetTypes = [];
                document.querySelectorAll('#assetTypeDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.remove('checked');
                });
            } else {
                selectedAssetTypes = [...allAssetTypes];
                document.querySelectorAll('#assetTypeDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.add('checked');
                });
            }

            updateAssetTypeDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleQuality(event, quality) {
            event.stopPropagation();
            const checkbox = document.getElementById(`quality_${quality}`);
            const index = selectedQualities.indexOf(quality);

            if (index > -1) {
                selectedQualities.splice(index, 1);
                checkbox.classList.remove('checked');
            } else {
                selectedQualities.push(quality);
                checkbox.classList.add('checked');
            }

            updateQualityDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleAllQualities(event) {
            event.stopPropagation();
            const qualityCounts = {};
            allSignals.forEach(s => {
                qualityCounts[s.quality] = true;
            });

            const allQualities = Object.keys(qualityCounts);

            if (selectedQualities.length === allQualities.length) {
                selectedQualities = [];
                document.querySelectorAll('#qualityDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.remove('checked');
                });
            } else {
                selectedQualities = [...allQualities];
                document.querySelectorAll('#qualityDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.add('checked');
                });
            }

            updateQualityDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleSetup(event, setup) {
            event.stopPropagation();
            const setupId = setup.replace(/\s+/g, '_').replace(/\./g, '_');
            const checkbox = document.getElementById(`setup_${setupId}`);
            const index = selectedSetups.indexOf(setup);

            if (index > -1) {
                selectedSetups.splice(index, 1);
                checkbox.classList.remove('checked');
            } else {
                selectedSetups.push(setup);
                checkbox.classList.add('checked');
            }

            updateSetupDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function toggleAllSetups(event) {
            event.stopPropagation();
            const setupCounts = {};
            allSignals.forEach(s => {
                setupCounts[s.setup] = true;
            });

            const allSetups = Object.keys(setupCounts);

            if (selectedSetups.length === allSetups.length) {
                selectedSetups = [];
                document.querySelectorAll('#setupDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.remove('checked');
                });
            } else {
                selectedSetups = [...allSetups];
                document.querySelectorAll('#setupDropdownMenu .dropdown-checkbox').forEach(cb => {
                    cb.classList.add('checked');
                });
            }

            updateSetupDropdownText();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function updateAssetTypeDropdownText() {
            const text = document.getElementById('assetTypeDropdownText');
            if (!text) return;
            if (selectedAssetTypes.length === 0) {
                text.textContent = 'Todos os tipos';
            } else if (selectedAssetTypes.length === 1) {
                text.textContent = selectedAssetTypes[0];
            } else {
                text.textContent = `${selectedAssetTypes.length} selecionados`;
            }
        }

        function updateQualityDropdownText() {
            const text = document.getElementById('qualityDropdownText');
            if (!text) return;
            if (selectedQualities.length === 0) {
                text.textContent = 'Todas as qualidades';
            } else if (selectedQualities.length === 1) {
                text.textContent = selectedQualities[0];
            } else {
                text.textContent = `${selectedQualities.length} selecionadas`;
            }
        }

        function updateSetupDropdownText() {
            const text = document.getElementById('setupDropdownText');
            if (!text) return;
            if (selectedSetups.length === 0) {
                text.textContent = 'Todos os setups';
            } else if (selectedSetups.length === 1) {
                text.textContent = selectedSetups[0];
            } else {
                text.textContent = `${selectedSetups.length} selecionados`;
            }
        }

        function updateActiveFiltersDisplay() {
            const display = document.getElementById('activeFiltersDisplay');
            if (!display) return;

            const allFilters = [...selectedAssetTypes, ...selectedQualities, ...selectedSetups, ...activeQuickFilters];
            const searchTerm = document.getElementById('searchTicker')?.value || '';
            const signalFilter = document.getElementById('filterSignal')?.value || 'all';

            if (searchTerm) allFilters.push(`Busca: ${searchTerm}`);
            if (signalFilter !== 'all') allFilters.push(signalFilter);

            if (allFilters.length === 0) {
                display.innerHTML = `
                    <span class="text-xs text-gray-400">Filtros ativos:</span>
                    <span class="text-xs text-gray-500 italic">Nenhum filtro aplicado</span>
                `;
            } else {
                let html = '<span class="text-xs text-gray-400">Filtros ativos:</span>';
                allFilters.forEach(filter => {
                    const tagClass = getTagClass(filter);
                    html += `
                        <span class="tag-pill ${tagClass} cursor-pointer" onclick="removeFilter('${filter}')">
                            ${filter} <i class="fas fa-times ml-1 text-xs"></i>
                        </span>
                    `;
                });
                display.innerHTML = html;
            }
        }

        function removeFilter(filter) {
            // Remover de arrays
            let index = selectedAssetTypes.indexOf(filter);
            if (index > -1) {
                selectedAssetTypes.splice(index, 1);
                const checkbox = document.getElementById(`assetType_${filter}`);
                if (checkbox) checkbox.classList.remove('checked');
                updateAssetTypeDropdownText();
            }

            index = selectedQualities.indexOf(filter);
            if (index > -1) {
                selectedQualities.splice(index, 1);
                const checkbox = document.getElementById(`quality_${filter}`);
                if (checkbox) checkbox.classList.remove('checked');
                updateQualityDropdownText();
            }

            index = selectedSetups.indexOf(filter);
            if (index > -1) {
                const setupId = filter.replace(/\s+/g, '_').replace(/\./g, '_');
                selectedSetups.splice(index, 1);
                const checkbox = document.getElementById(`setup_${setupId}`);
                if (checkbox) checkbox.classList.remove('checked');
                updateSetupDropdownText();
            }

            index = activeQuickFilters.indexOf(filter);
            if (index > -1) {
                activeQuickFilters.splice(index, 1);
                renderQuickFilters();
            }

            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }

        function clearTradingFilters() {
            document.getElementById('searchTicker').value = '';
            document.getElementById('filterSignal').value = 'all';
            selectedAssetTypes = [];
            selectedQualities = [];
            selectedSetups = [];
            activeQuickFilters = [];

            // Desmarcar checkboxes
            document.querySelectorAll('.dropdown-checkbox').forEach(cb => cb.classList.remove('checked'));

            updateAssetTypeDropdownText();
            updateQualityDropdownText();
            updateSetupDropdownText();
            renderQuickFilters();
            updateActiveFiltersDisplay();
            renderizarTodosSinais();
        }
        
        function recarregarDados() {
            carregarDados();
            if (document.getElementById('page-home').classList.contains('active')) {
                loadHomeAssimetriaCard();
            }
        }
        
        // ============================
        // FUNÇÕES DE ASSIMETRIA
        // ============================
        async function loadAssimetriaData() {
            try {
                document.getElementById('assimetriaLoading').classList.remove('hidden');

                // Carregar dados completos
                const response = await fetch(`${API_URL}/assimetria/`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                console.log('✅ Dados de assimetria recebidos:', data);

                // Carregar resumo
                const resumoResponse = await fetch(`${API_URL}/assimetria/resumo`);
                const resumo = await resumoResponse.json();

                assimetriaData = {
                    signals: data.signals || [],
                    resumo: resumo
                };

                document.getElementById('assimetriaLoading').classList.add('hidden');

                if (assimetriaData.signals.length === 0) {
                    document.getElementById('assimetriaEmpty').classList.remove('hidden');
                } else {
                    document.getElementById('assimetriaEmpty').classList.add('hidden');
                    updateAssimetriaCards();
                    renderAssimetriaTable();
                    createAssimetriaChart();
                }
            } catch (error) {
                console.error('❌ Erro ao carregar dados de assimetria:', error);
                document.getElementById('assimetriaLoading').classList.add('hidden');
                document.getElementById('assimetriaEmpty').classList.remove('hidden');
            }
        }

        function updateAssimetriaCards() {
            const resumo = assimetriaData.resumo;
            document.getElementById('assimetria-total').textContent = resumo.total || 0;
            document.getElementById('assimetria-sobrecomprados').textContent = resumo.sobrecomprados || 0;
            document.getElementById('assimetria-sobrevendidos').textContent = resumo.sobrevendidos || 0;

            // Calcular críticas
            const criticas = assimetriaData.signals.filter(s => Math.abs(s.z_score) >= 3).length;
            document.getElementById('assimetria-criticas').textContent = criticas;
        }

        function renderAssimetriaTable(filteredData = null) {
            const tbody = document.getElementById('assimetriaTableBody');
            let data = filteredData || assimetriaData.signals;

            // Ordenação padrão: Z-Score descendente
            if (!filteredData) {
                data = [...data].sort((a, b) => Math.abs(b.z_score) - Math.abs(a.z_score));
            }

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            Nenhum sinal encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = data.map(signal => {
                const zscoreColor = Math.abs(signal.z_score) >= 3 ? 'text-orange-500' :
                                   Math.abs(signal.z_score) >= 2.5 ? 'text-gold' : 'text-white';
                const statusColor = signal.status === 'Sobrecomprado' ? 'text-blue-500' : 'text-red-500';

                return `
                    <tr class="border-b border-gray-800 hover:bg-gray-800/30 transition">
                        <td class="py-3 px-4 text-center font-bold text-white">
                            ${signal.ticker}
                        </td>
                        <td class="py-3 px-4 text-center text-white">
                            R$ ${signal.valor_atual.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center text-gray-400">
                            R$ ${signal.media_6m.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center font-bold ${zscoreColor}">
                            ${signal.z_score >= 0 ? '+' : ''}${signal.z_score.toFixed(2)}
                        </td>
                        <td class="py-3 px-4 text-center text-gray-300">
                            ${(signal.volatilidade_anualizada * 100).toFixed(1)}%
                        </td>
                        <td class="py-3 px-4 text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColor} bg-opacity-20">
                                ${signal.status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function createAssimetriaChart() {
            const canvas = document.getElementById('assimetriaChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // Destruir gráfico anterior se existir
            if (assimetriaChart) {
                assimetriaChart.destroy();
            }

            // Dados base
            const baseSignals = assimetriaData.signals;

            // Separar sobrecomprados e sobrevendidos
            const sobrecomprados = baseSignals.filter(s => s.status === 'Sobrecomprado');
            const sobrevendidos = baseSignals.filter(s => s.status === 'Sobrevendido');

            // Adicionar tickers customizados
            const customDataset = customTickers.map(ticker => {
                const signal = baseSignals.find(s => s.ticker.toUpperCase() === ticker.toUpperCase());
                if (signal) {
                    return {
                        x: signal.volatilidade_anualizada,
                        y: signal.z_score,
                        ticker: signal.ticker
                    };
                }
                return null;
            }).filter(d => d !== null);

            const datasets = [
                {
                    label: 'Sobrecompra',
                    data: sobrecomprados.map(s => ({
                        x: s.volatilidade_anualizada,
                        y: s.z_score,
                        ticker: s.ticker
                    })),
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'Sobrevenda',
                    data: sobrevendidos.map(s => ({
                        x: s.volatilidade_anualizada,
                        y: s.z_score,
                        ticker: s.ticker
                    })),
                    backgroundColor: 'rgba(239, 68, 68, 0.6)',
                    borderColor: 'rgba(239, 68, 68, 1)',
                    pointRadius: 6,
                    pointHoverRadius: 8
                }
            ];

            if (customDataset.length > 0) {
                datasets.push({
                    label: 'Customizados',
                    data: customDataset,
                    backgroundColor: 'rgba(156, 163, 175, 0.6)',
                    borderColor: 'rgba(156, 163, 175, 1)',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    pointStyle: 'triangle'
                });
            }

            assimetriaChart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#fff' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Ticker: ${point.ticker}`,
                                        `Z-Score: ${point.y.toFixed(2)}`,
                                        `Volatilidade: ${(point.x * 100).toFixed(1)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Volatilidade Anualizada',
                                color: '#fff'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            },
                            min: 0,
                            max: 0.6
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Z-Score (Desvios Padrão)',
                                color: '#fff'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#9ca3af' },
                            min: -4,
                            max: 4
                        }
                    }
                },
                plugins: [{
                    id: 'tickerLabels',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        ctx.save();
                        ctx.font = '10px Inter, sans-serif';
                        ctx.fillStyle = '#ffffff';
                        ctx.textAlign = 'left';
                        ctx.textBaseline = 'middle';

                        chart.data.datasets.forEach((dataset, datasetIndex) => {
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((point, index) => {
                                const ticker = dataset.data[index].ticker;
                                if (ticker) {
                                    ctx.fillText(ticker, point.x + 8, point.y);
                                }
                            });
                        });

                        ctx.restore();
                    }
                }, {
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const yAxis = chart.scales.y;
                        const xAxis = chart.scales.x;

                        ctx.save();
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([5, 5]);

                        // Linha y=0
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(0));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(0));
                        ctx.stroke();

                        // Linhas y=±2
                        ctx.strokeStyle = 'rgba(34, 197, 94, 0.5)';
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(2));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(2));
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(-2));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(-2));
                        ctx.stroke();

                        // Linhas y=±3
                        ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(3));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(3));
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yAxis.getPixelForValue(-3));
                        ctx.lineTo(xAxis.right, yAxis.getPixelForValue(-3));
                        ctx.stroke();

                        ctx.restore();
                    }
                }]
            });
        }

        function addCustomTickersToChart() {
            const input = document.getElementById('customTickersInput');
            const tickers = input.value.split(',').map(t => t.trim().toUpperCase()).filter(t => t);

            if (tickers.length === 0) {
                alert('Digite pelo menos um ticker. Exemplo: PETR4, VALE3');
                return;
            }

            // Verificar se os tickers existem nos dados
            const validTickers = tickers.filter(ticker => {
                return assimetriaData.signals.some(s => s.ticker.toUpperCase() === ticker);
            });

            if (validTickers.length === 0) {
                alert('Nenhum dos tickers digitados foi encontrado nos dados.');
                return;
            }

            customTickers = [...new Set([...customTickers, ...validTickers])];
            createAssimetriaChart();
            input.value = '';
            
            alert(`✅ ${validTickers.length} ticker(s) adicionado(s) ao gráfico!`);
        }

        function resetChart() {
            customTickers = [];
            createAssimetriaChart();
        }

        function applyAssimetriaFilters() {
            const tickerFilter = document.getElementById('filterTicker').value.toUpperCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const nivelFilter = document.getElementById('filterNivel').value;

            let filtered = assimetriaData.signals;

            if (tickerFilter) {
                filtered = filtered.filter(s => s.ticker.includes(tickerFilter));
            }

            if (statusFilter) {
                filtered = filtered.filter(s => s.status === statusFilter);
            }

            if (nivelFilter) {
                filtered = filtered.filter(s => s.nivel_oportunidade === nivelFilter);
            }

            renderAssimetriaTable(filtered);
        }
        
        function clearAssimetriaFilters() {
            document.getElementById('filterTicker').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterNivel').value = '';
            renderAssimetriaTable(assimetriaData.signals);
        }

        function sortAssimetriaTable(column) {
            if (!sortDirection[column]) {
                sortDirection[column] = 'asc';
            } else {
                sortDirection[column] = sortDirection[column] === 'asc' ? 'desc' : 'asc';
            }

            const sorted = [...assimetriaData.signals].sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (sortDirection[column] === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });

            renderAssimetriaTable(sorted);
        }
        
        // ============================
        // HOME - CARD DE ASSIMETRIA
        // ============================
        async function loadHomeAssimetriaCard() {
            try {
                const resumoResponse = await fetch(`${API_URL}/assimetria/resumo`);
                const resumo = await resumoResponse.json();
                
                document.getElementById('home-assimetria-total').textContent = resumo.total || 0;
                document.getElementById('home-assimetria-sobrecomprados').textContent = resumo.sobrecomprados || 0;
                document.getElementById('home-assimetria-sobrevendidos').textContent = resumo.sobrevendidos || 0;
                
                // Carregar dados completos para calcular críticas
                const response = await fetch(`${API_URL}/assimetria/`);
                const data = await response.json();
                const criticas = (data.signals || []).filter(s => Math.abs(s.z_score) >= 3).length;
                document.getElementById('home-assimetria-criticas').textContent = criticas;
            } catch (error) {
                console.error('Erro ao carregar dados de assimetria na Home:', error);
            }
        }
        
        // ============================
        // INICIALIZAÇÃO
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            carregarDados();
            loadHomeAssimetriaCard();

            // Event listeners para filtros de Trading
            ['searchTicker', 'filterSignal'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', () => {
                        updateActiveFiltersDisplay();
                        renderizarTodosSinais();
                    });
                    el.addEventListener('change', () => {
                        updateActiveFiltersDisplay();
                        renderizarTodosSinais();
                    });
                }
            });

            // Fechar dropdowns ao clicar fora
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.dropdown-custom')) {
                    document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('show'));
                    document.querySelectorAll('.dropdown-icon').forEach(i => i.classList.remove('open'));
                    document.querySelectorAll('.dropdown-toggle').forEach(t => t.classList.remove('active'));
                }
            });
        });
    </script>
</body>
</html>